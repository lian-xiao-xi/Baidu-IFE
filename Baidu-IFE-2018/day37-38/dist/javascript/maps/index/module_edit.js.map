{"version":3,"sources":["index/module_edit.js"],"names":["define","require","exports","common_1","Object","defineProperty","value","saveData","tableEle","getEle","document","thead_th","tbody_tr","ife_table_data","i","length","item","data_index","product","region","sale","j","thItem","getAttribute","textContent","trim","val","push","Number","console","log","window","top","localStorage","setItem","JSON","stringify","editData","cancel","td","classList","remove","sure","inputVal","isNaN","alert","tbody","addEventListener","event","targetEle","target","parent","parentElement","editInput","showDataEle","getElementById","parentTd","tdEditEle","add","insertAdjacentHTML","id","tagName","toLowerCase","keyCode","cancelAnather","domFir","contains","escEle","e","getElementsByClassName"],"mappings":"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","file":"../../index/module_edit.js","sourcesContent":["define([\"require\", \"exports\", \"../common/common\"], function (require, exports, common_1) {\n    \"use strict\";\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    /**\n     * 保存修改后的数据到浏览器\n     */\n    function saveData() {\n        const tableEle = common_1.getEle(document, '.data-table')[0];\n        const thead_th = common_1.getEle(tableEle, '.data-thead .thead-tr th');\n        const tbody_tr = common_1.getEle(tableEle, '.data-tbody .tbody-tr');\n        // let sale:number[] = new Array(12);\n        let ife_table_data = [];\n        for (let i = 0; i < tbody_tr.length; i++) {\n            let item = tbody_tr[i];\n            let data_index = {\n                product: '',\n                region: '',\n                sale: []\n            };\n            for (let j = 0; j < thead_th.length; j++) {\n                const thItem = thead_th[j];\n                switch (thItem.getAttribute('data-type')) {\n                    case '地区':\n                        data_index.region = common_1.getEle(item, 'td')[j].textContent.trim();\n                        break;\n                    case '商品':\n                        data_index.product = common_1.getEle(item, 'td')[j].textContent.trim();\n                        break;\n                    default:\n                        if (thItem.getAttribute('data-month') !== null) {\n                            const val = common_1.getEle(common_1.getEle(item, 'td')[j], '.show')[0].textContent.trim();\n                            data_index.sale.push(Number(val));\n                        }\n                        break;\n                }\n            }\n            ife_table_data.push(data_index);\n        }\n        console.log('保存到本地的 ife_table_data ---> ', ife_table_data);\n        window.top.localStorage.setItem('ife_table_data', JSON.stringify(ife_table_data));\n    }\n    exports.saveData = saveData;\n    function editData() {\n        // 取消按钮响应的事件：输入框消失，展示数据的元素显示\n        function cancel(td) {\n            common_1.getEle(td, '.show')[0].classList.remove('hide');\n            common_1.getEle(td, '.edit-input')[0].classList.remove('block');\n            common_1.getEle(td, '#cancel')[0].remove();\n            common_1.getEle(td, '#sure')[0].remove();\n        }\n        // 确认按钮响应的事件\n        function sure(td) {\n            let inputVal = common_1.getEle(td, 'input.edit-input')[0].value;\n            if (inputVal.trim() && !isNaN(Number(inputVal))) {\n                common_1.getEle(td, '.show')[0].textContent = inputVal;\n                cancel(td);\n            }\n            else {\n                alert('请输入数字');\n            }\n        }\n        const tbody = common_1.getEle(document, '.data-table .data-tbody')[0];\n        // 当鼠标点击某个数字的单元格时，这个数字进入编辑状态，单元格内容变成一个输入框，输入框右边是取消和确定\n        tbody.addEventListener('click', function (event) {\n            let targetEle = event.target;\n            let parent = targetEle.parentElement;\n            if (targetEle.getAttribute('data-id') === 'edit') {\n                let editInput = common_1.getEle(parent, 'input.edit-input')[0];\n                let showDataEle = common_1.getEle(parent, '.show')[0];\n                // 如果已经点击过其他td了，就先把那个取消，再继续\n                if (document.getElementById('cancel')) {\n                    // let cancel = document.getElementById('cancel');\n                    let parentTd = document.getElementById('cancel').parentElement;\n                    cancel(parentTd);\n                }\n                const tdEditEle = `<button id=\"cancel\" style=\"margin-right: 10px;\">取消</button><button id=\"sure\">确定</button>`;\n                editInput.classList.add('block');\n                showDataEle.classList.add('hide');\n                parent.insertAdjacentHTML('beforeend', tdEditEle);\n            }\n            if (targetEle.id === 'cancel') {\n                cancel(parent);\n            }\n            if (targetEle.id === 'sure') {\n                sure(parent);\n            }\n        });\n        // 在输入框中，按ESC键等同于按取消,按回车键等同于按确认\n        tbody.addEventListener('keydown', function (event) {\n            let target = event.target;\n            let parentTd = target.parentElement;\n            console.log(target);\n            if (target.tagName.toLowerCase() === 'input') {\n                switch (event.keyCode) {\n                    case 13:\n                        // console.log('回车键')\n                        sure(parentTd);\n                        break;\n                    case 27:\n                        // console.log('esc 键')\n                        cancel(parentTd);\n                        break;\n                    default:\n                        break;\n                }\n            }\n        });\n        // 点击该单元格以外的页面其他任何地方，除了响应对应行为外，同时等同于点击了取消，输入状态消失\n        function cancelAnather(domFir, target) {\n            // console.log(domFir, target, domFir.contains(target))\n            if (!(domFir == target || domFir.contains(target))) {\n                let escEle = document.getElementById('cancel');\n                if (escEle) {\n                    let parent = escEle.parentElement;\n                    cancel(parent);\n                    console.log('取消取消取消');\n                }\n            }\n        }\n        document.addEventListener('click', function (e) {\n            cancelAnather(document.getElementsByClassName('data-table')[0], e.target);\n        });\n    }\n    exports.editData = editData;\n});\n\n//# sourceMappingURL=../maps/index/module_edit.js.map\n"]}