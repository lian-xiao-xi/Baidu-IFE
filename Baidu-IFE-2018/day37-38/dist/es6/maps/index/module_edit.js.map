{"version":3,"sources":["index/module_edit.ts"],"names":[],"mappings":"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","file":"../../index/module_edit.js","sourcesContent":["import { getEle, dataFormat } from '../common/common'\r\n\r\n/**\r\n * 保存修改后的数据到浏览器\r\n */\r\nexport function saveData() {\r\n  const tableEle = getEle(document, '.data-table')[0];\r\n  const thead_th = getEle(tableEle, '.data-thead .thead-tr th');\r\n  const tbody_tr = getEle(tableEle, '.data-tbody .tbody-tr');\r\n\r\n  // let sale:number[] = new Array(12);\r\n  let ife_table_data: dataFormat[] = [];\r\n\r\n  for (let i = 0; i < tbody_tr.length; i++) {\r\n    let item = tbody_tr[i];\r\n    let data_index: dataFormat = {\r\n      product: '',\r\n      region: '',\r\n      sale: []\r\n    };\r\n\r\n    for (let j = 0; j < thead_th.length; j++) {\r\n      const thItem = thead_th[j];\r\n      switch (thItem.getAttribute('data-type')) {\r\n        case '地区':\r\n          data_index.region = getEle(item, 'td')[j].textContent.trim();\r\n          break;\r\n\r\n        case '商品':\r\n          data_index.product = getEle(item, 'td')[j].textContent.trim();\r\n          break;\r\n\r\n        default:\r\n          if (thItem.getAttribute('data-month') !== null) {\r\n            const val = getEle(getEle(item, 'td')[j], '.show')[0].textContent.trim();\r\n            data_index.sale.push(Number(val));\r\n          }\r\n          break;\r\n      }\r\n    }\r\n    ife_table_data.push(data_index)\r\n  }\r\n\r\n  console.log('保存到本地的 ife_table_data ---> ', ife_table_data)\r\n  window.top.localStorage.setItem('ife_table_data', JSON.stringify(ife_table_data))\r\n\r\n}\r\n\r\nexport function editData() {\r\n  // 取消按钮响应的事件：输入框消失，展示数据的元素显示\r\n  function cancel(td: Element) {\r\n    getEle(td, '.show')[0].classList.remove('hide')\r\n    getEle(td, '.edit-input')[0].classList.remove('block')\r\n    getEle(td, '#cancel')[0].remove();\r\n    getEle(td, '#sure')[0].remove();\r\n  }\r\n\r\n  // 确认按钮响应的事件\r\n  function sure(td: Element) {\r\n    let inputVal = (getEle(td, 'input.edit-input')[0] as HTMLInputElement).value;\r\n    if (inputVal.trim() && !isNaN(Number(inputVal))) {\r\n      getEle(td, '.show')[0].textContent = inputVal;\r\n      cancel(td);\r\n    } else {\r\n      alert('请输入数字');\r\n    }\r\n  }\r\n\r\n  const tbody = getEle(document, '.data-table .data-tbody')[0];\r\n\r\n  // 当鼠标点击某个数字的单元格时，这个数字进入编辑状态，单元格内容变成一个输入框，输入框右边是取消和确定\r\n  tbody.addEventListener('click', function (event) {\r\n    let targetEle = event.target as HTMLElement;\r\n    let parent = targetEle.parentElement;\r\n\r\n    if (targetEle.getAttribute('data-id') === 'edit') {\r\n      let editInput = getEle(parent, 'input.edit-input')[0] as HTMLInputElement;\r\n      let showDataEle = getEle(parent, '.show')[0];\r\n      // 如果已经点击过其他td了，就先把那个取消，再继续\r\n      if (document.getElementById('cancel')) {\r\n        // let cancel = document.getElementById('cancel');\r\n        let parentTd = document.getElementById('cancel').parentElement;\r\n        cancel(parentTd);\r\n      }\r\n\r\n      const tdEditEle = `<button id=\"cancel\" style=\"margin-right: 10px;\">取消</button><button id=\"sure\">确定</button>`;\r\n      editInput.classList.add('block')\r\n      showDataEle.classList.add('hide')\r\n      parent.insertAdjacentHTML('beforeend', tdEditEle)\r\n    }\r\n\r\n    if (targetEle.id === 'cancel') {\r\n      cancel(parent)\r\n    }\r\n\r\n    if (targetEle.id === 'sure') {\r\n      sure(parent)\r\n    }\r\n  })\r\n\r\n  // 在输入框中，按ESC键等同于按取消,按回车键等同于按确认\r\n  tbody.addEventListener('keydown', function (event: KeyboardEvent) {\r\n    let target = event.target as Element;\r\n    let parentTd = target.parentElement;\r\n    console.log(target);\r\n    if (target.tagName.toLowerCase() === 'input') {\r\n      switch (event.keyCode) {\r\n        case 13:\r\n          // console.log('回车键')\r\n          sure(parentTd)\r\n          break;\r\n\r\n        case 27:\r\n          // console.log('esc 键')\r\n          cancel(parentTd);\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n  })\r\n\r\n  // 点击该单元格以外的页面其他任何地方，除了响应对应行为外，同时等同于点击了取消，输入状态消失\r\n  function cancelAnather(domFir, target) {\r\n    // console.log(domFir, target, domFir.contains(target))\r\n    if (!(domFir == target || domFir.contains(target))) {\r\n      let escEle = document.getElementById('cancel')\r\n      if (escEle) {\r\n        let parent = escEle.parentElement;\r\n        cancel(parent)\r\n        console.log('取消取消取消');\r\n      }\r\n    }\r\n  }\r\n\r\n  document.addEventListener('click', function (e) {\r\n    cancelAnather(document.getElementsByClassName('data-table')[0], e.target)\r\n  });\r\n\r\n}"]}